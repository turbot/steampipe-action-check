name: Manual Workflow Example
on:
  workflow_dispatch:
    inputs:
      mod_branch:
        description: Branch of the mod to use in checks
        required: true
        default: main
      snapshot:
        description: Upload a snapshot to Turbot Pipes, if set to a value other than 'none', secrets.PIPES_TOKEN must be configured on the repository.
        required: false
        default: 'none'
        type: choice
        options:
          - none
          - public
          - private
      annotations:
        description: Apply annotations
        required: false
        default: false
        type: boolean

jobs:
  aws_tf_compliance:
    permissions:
      pull-requests: write
      checks: write
    runs-on: ubuntu-latest
    steps:
      - name: Repository Checkout
        uses: actions/checkout@v3
      - name: Steampipe Setup
        uses: turbot/steampipe-action-setup@v1.4.0
        with:
          plugin-connections: |
            connection "tf" {
              plugin = "terraform"
              paths  = [ "./examples/terraform/aws/**/*.tf" ]
            }
      - name: Steampipe Checks
        uses: ./
        with:
          mod-url: https://github.com/turbot/steampipe-mod-terraform-aws-compliance
          mod-branch: ${{ inputs.mod_branch }}
          snapshot-type: ${{ inputs.snapshot }}
          pipes-token: ${{ secrets.PIPES_TOKEN }}
          create-annotations: ${{ inputs.annotations }}